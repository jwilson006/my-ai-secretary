<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Secretary - Your Personal Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            height: 95vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mode-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .mode-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .feature-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .feature-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .message.user .avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.assistant .avatar {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.assistant .message-content {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: border 0.3s;
        }

        #messageInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: transform 0.2s;
        }

        #sendBtn:hover {
            transform: scale(1.05);
        }

        #sendBtn:active {
            transform: scale(0.95);
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: scale(1);
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .quick-action {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            transition: transform 0.2s;
        }

        .quick-action:hover {
            transform: translateY(-2px);
        }

        .sidebar {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
            transition: right 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar-content {
            padding: 20px;
        }

        .sidebar h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .task-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .close-sidebar {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }

            .header h1 {
                font-size: 20px;
            }

            .message-content {
                max-width: 85%;
            }

            .quick-actions {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            background: white;
            border-radius: 18px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator.active {
            display: block;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 20px;
        }

        .status-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .status-badge.connected {
            background: rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.6);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <h1>ü§ñ AI Secretary</h1>
                <span class="status-badge connected">Powered by Claude</span>
            </div>
            <div class="header-controls">
                <button class="mode-toggle" id="modeToggle">üíº Professional Mode</button>
                <button class="feature-btn" id="tasksBtn">üìã Tasks</button>
            </div>
        </div>

        <div class="quick-actions">
            <button class="quick-action" data-action="schedule">üìÖ Schedule Meeting</button>
            <button class="quick-action" data-action="email">‚úâÔ∏è Draft Email</button>
            <button class="quick-action" data-action="research">üîç Research Topic</button>
            <button class="quick-action" data-action="brainstorm">üí° Brainstorm Ideas</button>
            <button class="quick-action" data-action="analyze">üìä Analyze Data</button>
            <button class="quick-action" data-action="reminder">‚è∞ Set Reminder</button>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="message assistant">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">Hey there! I'm your AI secretary powered by Claude. I can help with scheduling meetings, drafting emails, research, brainstorming, data analysis, and setting reminders. What can I help you with today?</div>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="messageInput" placeholder="Type your message here..." />
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <button class="close-sidebar" id="closeSidebar">√ó</button>
        <div class="sidebar-content">
            <h2>Tasks & Reminders</h2>
            <div id="tasksList">
                <div class="task-item">
                    <strong>No tasks yet</strong><br>
                    <small>Tasks will appear here</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatArea = document.getElementById('chatArea');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const modeToggle = document.getElementById('modeToggle');
        const quickActions = document.querySelectorAll('.quick-action');
        const tasksBtn = document.getElementById('tasksBtn');
        const sidebar = document.getElementById('sidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const tasksList = document.getElementById('tasksList');

        let mode = 'professional';
        let conversationHistory = [];
        let tasks = [];
        let systemPrompt = `You are a helpful AI secretary assistant. You help with scheduling meetings, drafting emails, research, brainstorming, data analysis, and setting reminders. You blend professional and casual tones naturally. Be concise but friendly and helpful.`;

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isUser ? 'üë§' : 'ü§ñ';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;

            conversationHistory.push({ 
                role: isUser ? 'user' : 'assistant', 
                content: content 
            });
        }

        function showTypingIndicator() {
            const typing = document.createElement('div');
            typing.className = 'message assistant';
            typing.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = 'ü§ñ';
            
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator active';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            
            typing.appendChild(avatar);
            typing.appendChild(indicator);
            chatArea.appendChild(typing);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function removeTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            chatArea.appendChild(errorDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            setTimeout(() => errorDiv.remove(), 5000);
        }

        async function getAIResponse(userMessage) {
            showTypingIndicator();
            sendBtn.disabled = true;
            messageInput.disabled = true;

            try {
                // Prepare messages for Claude API
                const messages = conversationHistory
                    .slice(-10) // Keep last 10 messages for context
                    .filter(msg => msg.role === 'user' || msg.role === 'assistant')
                    .map(msg => ({
                        role: msg.role,
                        content: msg.content
                    }));

                const response = await fetch('/.netlify/functions/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: messages,
                        systemPrompt: systemPrompt
                    })
                });

                const data = await response.json();

                removeTypingIndicator();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to get response');
                }

                addMessage(data.content, false);

                // Auto-add tasks for certain requests
                const lowerMsg = userMessage.toLowerCase();
                if (lowerMsg.includes('schedule') || lowerMsg.includes('meeting') || 
                    lowerMsg.includes('remind') || lowerMsg.includes('task')) {
                    addTask(userMessage);
                }

            } catch (error) {
                removeTypingIndicator();
                console.error('Error:', error);
                showError('Failed to get AI response. Please make sure your API key is configured in Netlify.');
                addMessage("I'm having trouble connecting right now. Please check that your API key is set up correctly in Netlify environment variables.", false);
            } finally {
                sendBtn.disabled = false;
                messageInput.disabled = false;
                messageInput.focus();
            }
        }

        function addTask(taskName) {
            tasks.push({ name: taskName, created: new Date() });
            updateTasksList();
        }

        function updateTasksList() {
            tasksList.innerHTML = '';
            if (tasks.length === 0) {
                tasksList.innerHTML = '<div class="task-item"><small>No tasks yet</small></div>';
            } else {
                tasks.forEach((task, index) => {
                    const taskDiv = document.createElement('div');
                    taskDiv.className = 'task-item';
                    taskDiv.innerHTML = `<strong>${task.name}</strong><br><small>${task.created.toLocaleString()}</small>`;
                    tasksList.appendChild(taskDiv);
                });
            }
        }

        sendBtn.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (message && !sendBtn.disabled) {
                addMessage(message, true);
                messageInput.value = '';
                getAIResponse(message);
            }
        });

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendBtn.disabled) {
                sendBtn.click();
            }
        });

        modeToggle.addEventListener('click', () => {
            mode = mode === 'professional' ? 'casual' : 'professional';
            modeToggle.textContent = mode === 'professional' ? 'üíº Professional Mode' : 'üòé Casual Mode';
            
            systemPrompt = mode === 'professional' 
                ? `You are a professional AI secretary assistant. Keep responses business-focused and formal but still warm. Help with scheduling meetings, drafting emails, research, brainstorming, data analysis, and setting reminders.`
                : `You are a friendly, casual AI secretary assistant. Keep it relaxed and natural while being helpful. Help with scheduling, emails, research, brainstorming, analysis, and reminders. Be conversational and fun!`;
            
            const modeMsg = mode === 'professional'
                ? `Switched to professional mode. I'll keep things business-focused.`
                : `Switched to casual mode. Let's keep it fun and relaxed!`;
            addMessage(modeMsg, false);
        });

        quickActions.forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.dataset.action;
                const prompts = {
                    schedule: "I need to schedule a meeting",
                    email: "Help me draft an email",
                    research: "I need you to research something for me",
                    brainstorm: "Let's brainstorm some ideas",
                    analyze: "I need help analyzing some data",
                    reminder: "Set a reminder for me"
                };
                messageInput.value = prompts[action];
                messageInput.focus();
            });
        });

        tasksBtn.addEventListener('click', () => {
            sidebar.classList.add('active');
        });

        closeSidebar.addEventListener('click', () => {
            sidebar.classList.remove('active');
        });

        // Focus input on load
        messageInput.focus();
    </script>
</body>
</html>
